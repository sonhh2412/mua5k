'use strict';angular.module('shopnxApp').directive('headerTopCount',function(Product,$timeout,Hook,socket){return{link:function(scope,element,attribute){var elementScrollParent=angular.element(document.querySelectorAll('.num-counter span.num cite')),element_height=35;var listnum=[0,0,0,0,0,0,0,0,0,0,0];var listItemElement=[[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0],[9,8,7,6,5,4,3,2,1,0]];var runTimeOut,isRunTimeOut=false;var runTimeout0,runTimeout1,runTimeout2,runTimeout3,runTimeout4,runTimeout5,runTimeout6,runTimeout7,runTimeout8,runTimeout9,runTimeout10;var randumnum=function(number){var index_list=10;while(number>0&&index_list>=0){listnum[index_list]=number%10;number=Math.floor(number/10);index_list=index_list-1};runTimeout10=setTimeout(scrollElementByNum(listnum[10],10),200);runTimeout9=setTimeout(scrollElementByNum(listnum[9],9),200);runTimeout8=setTimeout(scrollElementByNum(listnum[8],8),300);runTimeout7=setTimeout(scrollElementByNum(listnum[7],7),400);runTimeout6=setTimeout(scrollElementByNum(listnum[6],6),500);runTimeout5=setTimeout(scrollElementByNum(listnum[5],5),600);runTimeout4=setTimeout(scrollElementByNum(listnum[4],4),700);runTimeout3=setTimeout(scrollElementByNum(listnum[3],3),800);runTimeout2=setTimeout(scrollElementByNum(listnum[2],2),900);runTimeout1=setTimeout(scrollElementByNum(listnum[1],1),1000);runTimeout0=setTimeout(scrollElementByNum(listnum[0],0),1100)};var scrollElementByNum=function(number,index_element){var elementScroll=elementScrollParent.eq(index_element);var children=elementScroll.children();_.each(children,function(item,index){if(listItemElement[index_element][index]==number){elementScroll.stop();var marginTopbefore=Math.abs(parseInt(elementScroll.css('marginTop').replace('px','')));var index_current_tmp;elementScroll.animate({marginTop:parseInt(elementScroll.css('marginTop').replace('px',''))+Math.abs(marginTopbefore%element_height)+'px'},1);index_current_tmp=Math.abs(parseInt(marginTopbefore/element_height));if(index>index_current_tmp){var index_tmp=9;elementScroll.stop();while(index_tmp>index_current_tmp){var number_tmp=listItemElement[index_element].pop();var element_tmp=children.eq(index_tmp);elementScroll.prepend('<em t="'+number_tmp+'">'+number_tmp+'</em>');listItemElement[index_element].unshift(number_tmp);elementScroll.css('marginTop',parseInt(elementScroll.css('marginTop').replace('px',''))-element_height+'px');children[index_tmp].remove();index_tmp=index_tmp-1}children=elementScroll.children();index=listItemElement[index_element][9]-number-1;index=index<0?9+index+1:index;var element=children.eq(index);elementScroll.stop();elementScroll.animate({marginTop:(element_height*-9)+(element_height*(9-index))+'px'},1500);return}else{var element=children.eq(index);elementScroll.stop();elementScroll.animate({marginTop:(element_height*-9)+(element_height*(9-index))+'px'},1500);return}}})};var callMyTimeOut=function(number,miliseconds){if(isRunTimeOut){stopMyTimeOut();isRunTimeOut=false}isRunTimeOut=true;runTimeOut=setTimeout(randumnum(number),miliseconds)};var stopMyTimeOut=function(){clearTimeout(runTimeout10);clearTimeout(runTimeout9);clearTimeout(runTimeout8);clearTimeout(runTimeout7);clearTimeout(runTimeout6);clearTimeout(runTimeout5);clearTimeout(runTimeout4);clearTimeout(runTimeout3);clearTimeout(runTimeout2);clearTimeout(runTimeout1);clearTimeout(runTimeout0);clearTimeout(runTimeOut)};Hook.getCount.query().$promise.then(function(result){setTimeout(function(){callMyTimeOut(result[0],3000);socket.socket.on('product:count',function(data){callMyTimeOut(data,3000)})},3000)})},restrict:'E',scope:true,templateUrl:'components/master/views/tpl.header.top.count.html'}}).directive('hashUser',function(Auth){return{link:function(scope,element,attribute){scope.$watch('user',function(user){Auth.getUserbyDir(user).then(function(data){scope.user_result=data.name}).catch(function(err){scope.user_result=''})})},restrict:'E',scope:{user:'=user'},templateUrl:'components/master/views/tpm.hash.user.html'}}).directive('hashUserEmail',function(Auth){return{link:function(scope,element,attribute){scope.$watch('user',function(user){Auth.getUserbyEmail(user).then(function(data){scope.user_result=data.name}).catch(function(err){scope.user_result=''})})},restrict:'E',scope:{user:'=user'},templateUrl:'components/master/views/tpm.hash.user.by.email.html'}});