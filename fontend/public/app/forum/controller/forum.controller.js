'use strict'; angular.module('shopnxApp') .controller('ForumCtrl', function($scope, $rootScope, Forum) {$scope.session = {}; $scope.listcate = {}; $scope.listpostlast = {}; $scope.listpostcommon = {}; $rootScope.isPageProduct = false; $rootScope.isHomePage = false; $rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : true, help : false, }; Forum.listCategoriesPushlic.query(). $promise.then(function(reslut){$scope.listcate = reslut; }); Forum.listPostLast.query(). $promise.then(function(result){$scope.listpostlast = result; }); Forum.listPostCommon.query(). $promise.then(function(result){$scope.listpostcommon = result; }); }) .controller('ListcategoryCtrl',function($scope, Forum, Auth, $rootScope, $location,$mdDialog,$window){$rootScope.isPageProduct = false; $rootScope.isHomePage = false; Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); }else{$rootScope.isAdmin = Auth.isAdmin(); if (!$rootScope.isAdmin) {$location.path('/dang-nhap.html'); } else {$scope.session = {}; $scope.listcate = {}; Forum.listCategories.query(). $promise.then(function(reslut){$scope.listcate = reslut; }); $scope.isAddFormOpen = false; $scope.ViewFormOpen = function() {$scope.isAddFormOpen = true; $scope.session.name = null; $scope.session.slug = null; $scope.session.image = null; $scope.session.parent_id = 0; $scope.session.description = null; $scope.session.state = 1; $scope.session._id = null; }; $scope.CloseFormOpen = function(){$scope.isAddFormOpen = false; }; $scope.editForumCategory = function(id){$scope.session.name = $scope.listcate[id].name; $scope.session.slug = $scope.listcate[id].slug; $scope.session.image = $scope.listcate[id].image; $scope.session.parent_id = $scope.listcate[id].parent_id; $scope.session.description = $scope.listcate[id].description; $scope.session.state = $scope.listcate[id].state; $scope.session._id = $scope.listcate[id]._id; $scope.isAddFormOpen = true; }; $scope.RemoveForumCategory = function(id){var confirm = $mdDialog.confirm() .title('Bạn có muốn xóa danh mục này?') .targetEvent(id) .ok('Xóa') .cancel('Hủy'); $mdDialog.show(confirm).then(function() {Forum.removeCategories.remove({id: id }) .$promise.then(function(reslut){$window.location.reload(); }) .catch(function(err){}); }, function() {}); }; $scope.submit = function(){Forum.addCategories.save($scope.session) .$promise.then(function(reslut){$window.location.reload(); }) .catch(function(err){}); }; } } }); }) .controller('addPostCtrl',function($scope, Forum, Auth, $location, $rootScope){$rootScope.isPageProduct = false; $rootScope.isHomePage = false; Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); }else{$scope.session = {}; $scope.listcate = {}; Forum.addNewPost.save(). $promise.then(function(result){}); } }); }) .controller('listPostbycategoryCtrl', function($scope, Auth, $rootScope, Forum, $stateParams, $window,$location) {$rootScope.isPageProduct = false; $rootScope.isHomePage = false; $scope.session = {}; $scope.cateitem = {}; $scope.listpostlast = {}; $scope.listpostcommon = {}; $scope.urlForumCommon = '/api/forum/listPostCommonbySlug/' + $stateParams.slug; $scope.urlForumLast = '/api/forum/listPostLastbySlug/' + $stateParams.slug; $rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : true, help : false, }; $rootScope.childLink = $stateParams.slug; $rootScope.parmasCateg = {watting_result : true, product_hot : false, not_enough : false, new_product : false, restricted_area : false, }; Auth.isLoggedInAsync(function(cb){$rootScope.isAdmin = Auth.isAdmin(); }); Forum.getCategorybySlug.get({slug: $stateParams.slug }) .$promise.then(function(result) {$scope.cateitem = result; $scope.session = {cate_slug : $scope.cateitem.slug, cate_id : $scope.cateitem._id, parent_id : $scope.cateitem.parent_id }; }) .catch(function(err){}); $scope.isAddFormOpen = false; $scope.ViewFormOpen = function() {Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); }else{$scope.isAddFormOpen = true; $scope.session.title = null; $scope.session.content = null; $scope.submit = function(){$scope.session.auth = Auth.getCurrentUser()._id; Forum.addNewPost.save($scope.session) .$promise.then(function(reslut){$window.location.reload(); }) .catch(function(err){}); }; } }); }; $scope.CloseFormOpen = function(){$scope.isAddFormOpen = false; }; var md = new MobileDetect(window.navigator.userAgent); $scope.doTheBack = function() {window.history.back(); } ; $scope.isMobile = false; $scope.isnotMobile = true; if(md.mobile() != null){$scope.isMobile = true; $scope.isnotMobile = false; } }) .controller('PostDetailCtrl', function($scope, Auth, $rootScope, Forum, $stateParams, $window, $anchorScroll, $location) {$rootScope.isPageProduct = false; $rootScope.isHomePage = false; $scope.session = {}; $scope.postitem = {}; $scope.authorinfo = {}; $scope.cateitem = {}; $rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : true, help : false, }; $rootScope.childLink = $stateParams.slug; $rootScope.parmasCateg = {watting_result : true, product_hot : false, not_enough : false, new_product : false, restricted_area : false, }; Forum.getPostbySlug.get({slug: $stateParams.slug }) .$promise.then(function(result) {var user_id = result.auth; if(user_id != ''){Auth.getUserbyId(user_id).then(function(rel){$scope.authorinfo = rel; }); $scope.postitem = result; $scope.urlPostComment = '/api/forum/paginatePostComment/'+$scope.postitem._id; $scope.session.post_id = $scope.postitem._id; } Forum.getCategorybyId.get({id: result.cate_id }) .$promise.then(function(res_cate) {$scope.cateitem = res_cate; }) .catch(function(err){}); }) .catch(function(err){}); $scope.scrollTo = function(id) {console.log(id); $location.hash(id); $anchorScroll(); } ; $scope.isAddCommentOpen = false; $scope.isMessNotLogin = false; Auth.isLoggedInAsync(function(cb){if(!cb){$scope.isAddCommentOpen = false; $scope.isMessNotLogin = true; }else{$scope.isAddCommentOpen = true; $scope.isMessNotLogin = false; $scope.session = {_id : Auth.getCurrentUser()._id, avatar : Auth.getCurrentUser().avatar }; $scope.submit = function(){Forum.addNewComment.save($scope.session) .$promise.then(function(reslut){$scope.reloadPage = true; $scope.session.comment_content = ''; }) .catch(function(err){}); }; } }); })