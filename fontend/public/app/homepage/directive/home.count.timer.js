'use strict'; angular.module('shopnxApp') .directive('homeNewLottery', function ($loading, Product, socket, $rootScope, Hook, $interval) {return {restrict: 'E', scope : {product : '=', }, templateUrl: 'app/homepage/views/home.count.timer.html', link: function (scope, element, attribute) {scope.$watch('product',function(product) {if(typeof product != 'undefined'){scope.timer = "00 : 00 : 00"; var expires = new Date(); expires.setSeconds(expires.getSeconds() + parseInt(scope.product.second_product)); var counterTest = $interval( function () {var timeDiff = expires - new Date(); if (timeDiff <=0) {$interval.cancel(counterTest); scope.timer = "00 : 00 : 00"; scope.product.second_product = 0; return; } var dateDiff = new Date(timeDiff); var minutes = new Date(timeDiff).getMinutes(); var seconds = new Date(timeDiff).getSeconds(); var milliSeconds = (new Date(timeDiff).getMilliseconds()/10).toFixed(0); minutes = minutes < 10 ? "0" + minutes: minutes; seconds = seconds < 10 ? "0" + seconds: seconds; milliSeconds = milliSeconds < 10 ? "0" + milliSeconds: milliSeconds; scope.timer = minutes + " : "+ seconds + " : " + milliSeconds; }, 1); } }) } }; })