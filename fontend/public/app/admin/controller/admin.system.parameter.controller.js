'use strict';angular.module('shopnxApp').controller('ManageSystemParameter',function($scope,Auth,$rootScope,SystemParameters,$location,$mdDialog,$window){$window.scrollTo(0,0);$rootScope.isPageProduct=false;$rootScope.isHomePage=false;$scope.session={};$rootScope.parmas={home:false,waiting_result:false,restricted_area:false,customer_share:false,forum:false,help:false,};Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html');}else{$rootScope.isAdmin=Auth.isAdmin();if(!$rootScope.isAdmin){$location.path('/dang-nhap.html');}else{$scope.systemparameter={};$scope.is_showAddButton=false;$scope.urlListParams='/api/system_parameter/get-list-parameter';$scope.$watch('listparams',function(datas){if(typeof datas!='undefined'){var index=0;if(datas.results.length===0){$scope.is_showAddButton=true;}else{$scope.is_showAddButton=false;}
_.each(datas.results,function(key,value){$scope["active_"+key]=false;$scope["edit_"+key]=false;$scope["post_"+index]={};$scope["post_"+index].name=$scope.listparams.results[index].name;$scope["post_"+index].key=$scope.listparams.results[index].key;$scope["post_"+index].value=$scope.listparams.results[index].value;$scope["post_"+index]._id=$scope.listparams.results[index]._id;index++;});}else{$scope.is_showAddButton=false;}});$scope.isAddFormOpen=false;$scope.ViewFormOpen=function(){$scope.isAddFormOpen=true;$scope.systemparameter.name=null;$scope.systemparameter.key=null;$scope.systemparameter.value=null;$scope.systemparameter._id=null;};$scope.CloseFormOpen=function(id){if(id!=undefined){$scope["active_"+id]=false;$scope["edit_"+id]=false;}else{$scope.isAddFormOpen=false;}};$scope.showSystemParameter=function(id){if(!$scope["edit_"+id])$scope["active_"+id]=!$scope["active_"+id];};$scope.editSystemParameter=function(id){$scope["post_"+id]={};$scope["post_"+id].name=$scope.listparams.results[id].name;$scope["post_"+id].key=$scope.listparams.results[id].key;$scope["post_"+id].value=$scope.listparams.results[id].value;$scope["post_"+id]._id=$scope.listparams.results[id]._id;$scope["active_"+id]=true;$scope["edit_"+id]=true;};$scope.removeSystemParameter=function(id,key){var confirm=$mdDialog.confirm().title('Bạn có muốn xóa danh mục này?').targetEvent(id).ok('Xóa').cancel('Hủy');$mdDialog.show(confirm).then(function(){SystemParameters.removeParamater.remove({id:id}).$promise.then(function(result){$scope["active_"+key]=false;$scope["edit_"+key]=false;$scope.reloadPage=true;}).catch(function(err){});});};$scope.submit=function(){SystemParameters.addParameter.save($scope.systemparameter).$promise.then(function(result){$scope.isAddFormOpen=false;$scope.reloadPage=true;}).catch(function(err){});};$scope.submit_save=function(id){SystemParameters.addParameter.save($scope["post_"+id]).$promise.then(function(result){$scope["active_"+id]=true;$scope["edit_"+id]=false;$scope.reloadPage=true;}).catch(function(err){});};}}});})