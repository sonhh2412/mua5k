'use strict'; angular.module('shopnxApp') .controller('ManageNewsCtrl', function($scope, Auth, NewsContent, $rootScope, $location, $mdDialog){$rootScope.isPageProduct = false; $rootScope.isHomePage = false; $rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : false, help : false, }; Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); }else{$rootScope.isAdmin = Auth.isAdmin(); if (!$rootScope.isAdmin) {$location.path('/dang-nhap.html'); } else {$scope.news = {}; $scope.listnews = {}; $scope.isAddNews = false; $scope.urlNewsList = '/api/news/getListNews'; $scope.ViewFormOpen = function(){$scope.news.title = ''; $scope.news.content = ''; $scope.news.sequence = 1; $scope.news.state = 1; $scope.isAddNews = true; }; $scope.CloseFormOpen = function(){$scope.isAddNews = false; }; $scope.submit = function(){NewsContent.addNews.save($scope.news). $promise.then(function(result){$scope.isAddNews = false; $scope.reloadPage = true; }); }; $scope.RemoveNews = function(id){var confirm = $mdDialog.confirm() .title('Bạn có muốn xóa tin tức này?') .targetEvent(id) .ok('Xóa') .cancel('Hủy'); $mdDialog.show(confirm).then(function() {NewsContent.removeNews.remove({id: id }) .$promise.then(function(result){if ($scope.listnews.results.length === 1) {$scope.goto($scope.page > 0 ? $scope.page - 1 : 0); } $scope.reloadPage = true; }) .catch(function(err){}); }, function() {}); } } } }); }) .controller('NewsBySlugAdminCtrl', function($scope, Auth, NewsContent, $rootScope, $location, $stateParams, $window, $mdDialog){$rootScope.isPageProduct = false; $rootScope.isHomePage = false; $rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : false, help : false, }; Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); } else {$rootScope.isAdmin = Auth.isAdmin(); if (!$rootScope.isAdmin) {$location.path('/dang-nhap.html'); } else {$scope.news = {}; $scope.isEdit = false; $scope.isFoundNews = true; var getNewContent = function(){NewsContent.getNewsbySlug.get({slug: $stateParams.slug }) .$promise.then(function(result) {$scope.news = result; $scope.isFoundNews = $scope.news.title ? true : false; }) .catch(function(err){}); }; getNewContent(); $scope.backHistory = function(){$window.history.back(); }; $scope.EditNews = function(){$scope.isEdit = true; }; $scope.CloseFormOpen = function(){$scope.isEdit = false; getNewContent(); } ; $scope.submit = function(){NewsContent.editNews.save($scope.news). $promise.then(function(result){$scope.isEdit = false; getNewContent(); }) }; $scope.RemoveNews = function(id){var confirm = $mdDialog.confirm() .title('Bạn có muốn xóa tin tức này?') .targetEvent(id) .ok('Xóa') .cancel('Hủy'); $mdDialog.show(confirm).then(function() {NewsContent.removeNews.remove({id: id }) .$promise.then(function(result){$location.path('/quan-ly-tin-tuc.html'); }) .catch(function(err){}); }, function() {}); }; } } }); }) .controller('NewsBySlugUserCtrl', function($scope, Auth, NewsContent, $location, $stateParams, $window, $mdDialog, $rootScope){$rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : false, help : false, }; $rootScope.isPageProduct = false; $rootScope.isHomePage = false; Auth.isLoggedInAsync(function(cb){if(!cb){$scope.isLogin = false; $scope.isNotLogin = true; } else {$scope.isLogin = true; $scope.isNotLogin = false; } }); $scope.news = {}; var getNewContent = function(){NewsContent.getNewsbySlug.get({slug: $stateParams.slug }) .$promise.then(function(result) {$scope.news = result; }) .catch(function(err){}); }; getNewContent(); }) .controller('ListNewsCtrl', function($scope, NewsContent, $rootScope){$rootScope.parmas = {home : false, waiting_result : false, restricted_area : false, customer_share : false, forum : false, help : false, }; $rootScope.isPageProduct = false; $rootScope.isHomePage = false; $scope.news = {}; $scope.urlListNewsPage = '/api/news/listNewsActived'; })