'use strict'; angular.module('shopnxApp') .controller('ChangepasswordCtrl', function($scope, Auth, $location, $mdDialog, $window, $rootScope) {$rootScope.isPageProduct = false; $rootScope.isHomePage = false; Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); }else{$scope.provideruser = Auth.getCurrentUser().provider; if ($scope.provideruser == 'local') {$scope.session = {}; $scope.err_server = {}; $scope.session = {fullname : Auth.getCurrentUser().fullname, _id : Auth.getCurrentUser()._id, password_input : Auth.getCurrentUser().password_input }; var md = new MobileDetect(window.navigator.userAgent); $scope.doTheBack = function() {window.history.back(); }; $scope.isMobile = false; $scope.isnotMobile = true; if(md.mobile() != null){$scope.isMobile = true; $scope.isnotMobile = false; } $scope.submit = function(){$scope.provideruser = Auth.getCurrentUser().provider; if ($scope.provideruser == 'local') {Auth.updatePassword($scope.session) .then(function(data){$mdDialog.show($mdDialog.alert() .clickOutsideToClose(true) .title('Thông báo.') .textContent('Mật khẩu của bạn đã được cập nhập.') .ok('Ok') ).then(function() {$window.location.reload(); }); }) .catch(function(err){if (err.status == 403) $scope.errorMsg = "Mật khẩu cũ chưa đúng"; }); } else {$scope.errorMsg = "Cannot change password for account"; } }; } else {$location.path('/'); } } }); });