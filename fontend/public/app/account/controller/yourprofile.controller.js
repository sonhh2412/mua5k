'use strict'; angular.module('shopnxApp').controller('YourprofileCtrl', function($scope, Auth, Country_state, $location, $mdDialog, $rootScope, User, socket, $window) {$rootScope.isPageProduct = false; $rootScope.isHomePage = false; Auth.isLoggedInAsync(function(cb) {if (!cb) {$location.path('/dang-nhap.html'); } else {$scope.session = {}; $scope.err_server = {}; $scope.liststate = {}; $scope.provideruser = Auth.getCurrentUser().provider; Country_state.getCountrystate.query().$promise.then(function(result) {$scope.liststate = result; }); $scope.session = {fullname: Auth.getCurrentUser().fullname, _id: Auth.getCurrentUser()._id, telephone: Auth.getCurrentUser().telephone, gender: Auth.getCurrentUser().gender, street: Auth.getCurrentUser().street, email: Auth.getCurrentUser().email, state_id: Auth.getCurrentUser().state_id, income_monthly: Auth.getCurrentUser().income_monthly, signature: Auth.getCurrentUser().signature, curdate: new Date(Auth.getCurrentUser().year_of_birth + "-" + Auth.getCurrentUser().month_of_birth + "-" + Auth.getCurrentUser().day_of_birth), avatar: Auth.getCurrentUser().avatar, address: Auth.getCurrentUser().address }; var md = new MobileDetect(window.navigator.userAgent); $scope.doTheBack = function() {window.history.back(); }; $scope.isMobile = false; $scope.isnotMobile = true; if (md.mobile() != null) {$scope.isMobile = true; $scope.isnotMobile = false; } $scope.submit = function() {Auth.updateUserProfile($scope.session).then(function(data) {$mdDialog.show($mdDialog.alert().clickOutsideToClose(true).title('Thông báo.').textContent('Tài khoản của bạn đã được cập nhập.').ok('Ok')).then(function() {$window.location.reload(); $rootScope.getCurrentUser = User.get(); $scope.session.curdate = new Date(Auth.getCurrentUser().year_of_birth + "-" + Auth.getCurrentUser().month_of_birth + "-" + Auth.getCurrentUser().day_of_birth); }); }).catch(function(err) {}); }; socket.socket.on('user:save', function(data) {$scope.session = Auth.getCurrentUser()._id === data._id ? data : $scope.session; Auth.getCurrentUser()._id === data._id && ($scope.session.curdate = new Date($scope.session.year_of_birth + "-" + $scope.session.month_of_birth + "-" + $scope.session.day_of_birth)); }); } }); });