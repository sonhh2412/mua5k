'use strict';angular.module('shopnxApp').controller('ActiveEmailCtrl',function($scope,Auth,$stateParams,$location,socket,$rootScope,User,$loading,$interval,$mdDialog){$rootScope.isPageProduct=false;$rootScope.isHomePage=false;Auth.getUserActive($stateParams._id).then(function(cb){if(cb.actived){$location.path('/')}else{if(cb.isEmail===true){$scope.email=cb.email}}})}).controller('verifyAccountCtrl',function($scope,Auth,$stateParams,$location,socket,$rootScope,User,$loading,$interval,$mdDialog){$rootScope.isPageProduct=false;$rootScope.isHomePage=false;$scope.isTrue=false;_.size($stateParams)>1&&typeof $stateParams._id!='undefined'&&typeof $stateParams.code!='undefined'?(Auth.getInfoUserActive($stateParams._id+'_'+$stateParams.code).then(function(cb){$scope.session=cb.json;$scope.isTrue=true;Auth.isLoggedInAsync(function(cb){$rootScope.isLoggedIn=cb;$rootScope.isAdmin=Auth.isAdmin();cb&&($rootScope.getCurrentUser=Auth.getCurrentUser())})}).catch(function(err){$scope.isTrue=false})):($location.path("/"))}).controller('ActivePhoneCtrl',function($scope,Auth,$stateParams,$location,socket,$rootScope,User,$loading,$interval,$mdDialog){$rootScope.isPageProduct=false;$rootScope.isHomePage=false;$scope.session={};$scope.error={};$scope.error.isLogged=Auth.isLoggedIn();$scope.profile={};$scope.textCounterDown="00 : 00 : 00";var counterDown,expires;!$scope.error.isLogged?(Auth.getUserActive($stateParams._id).then(function(cb){function timerCountDown(){if($scope.profile.actived){$interval.cancel(counterDown);$mdDialog.show($mdDialog.alert().clickOutsideToClose(true).title('Thông báo.').textContent('Tài khoản này đã được kích hoạt.').ok('Trở về trang chủ')).then(function(){$location.path('/')})}else{var timeDiff=expires-new Date();var dateDiff=new Date(timeDiff);var minutes=new Date(timeDiff).getMinutes();var seconds=new Date(timeDiff).getSeconds();var milliSeconds=(new Date(timeDiff).getMilliseconds()/10).toFixed(0);minutes=minutes<10?"0"+minutes:minutes;seconds=seconds<10?"0"+seconds:seconds;if(milliSeconds>=100){milliSeconds=(milliSeconds/10).toFixed(0)}milliSeconds=milliSeconds<10?"0"+milliSeconds:milliSeconds;$scope.textCounterDown=minutes+" : "+seconds+" : "+milliSeconds;if(timeDiff<=0){$interval.cancel(counterDown);$scope.textCounterDown="00 : 00 : 00";Auth.removeUser($stateParams._id).then(function(result){$mdDialog.show($mdDialog.alert().clickOutsideToClose(true).title('Thông báo.').textContent('Đã quá thời gian kích hoạt. Tài khoản của bạn đã bị xóa.').ok('Trở về trang chủ')).then(function(){$location.path('/')})});return}}}$scope.profile=cb;expires=new Date();expires.setSeconds(expires.getSeconds()+$scope.profile.timeout);counterDown=$interval(timerCountDown,1)}),$scope.submit=function(){$loading.start('lazy-submit');Auth.setUserActive($stateParams._id,$scope.session.code,function(callback){callback.data==="Forbidden"&&callback.status===403&&($loading.finish('lazy-submit'),$scope.error.notFound=true)}).then(function(){Auth.isLoggedInAsync(function(cb){$rootScope.isLoggedIn=cb;$rootScope.isAdmin=Auth.isAdmin();cb&&($rootScope.getCurrentUser=Auth.getCurrentUser());$interval.cancel(counterDown);$loading.finish('lazy-submit');$location.path('/')})})}):($location.path("/"));socket.socket.on('user:remove',function(item){$scope.timeout=$stateParams._id===item._id})});