'use strict'; angular.module('shopnxApp') .controller('ShippingaddressCtrl', function($scope,Auth,Country_state, $location, $mdDialog, $rootScope) {$rootScope.isPageProduct = false; $rootScope.isHomePage = false; Auth.isLoggedInAsync(function(cb){if(!cb){$location.path('/dang-nhap.html'); }else{$scope.session = {}; $scope.err_server = {}; $scope.liststate = {}; $scope.addressitem = {}; $scope.provideruser = Auth.getCurrentUser().provider; Country_state.getCountrystate.query().$promise.then(function(result){$scope.liststate = result; }); $scope.session = {_id : Auth.getCurrentUser()._id, address : Auth.getCurrentUser().address }; $scope.isAddFormOpen = false; $scope.ViewFormOpen = function() {$scope.isAddFormOpen = true; $scope.session.name = null; $scope.session.phone = null; $scope.session.street = null; $scope.session.state_id = null; $scope.session.default = false; $scope.session.id = null; }; $scope.CloseFormOpen = function(){$scope.isAddFormOpen = false; }; $scope.editAddress = function(taskId){$scope.session.name = $scope.session.address[taskId].name; $scope.session.phone = $scope.session.address[taskId].phone; $scope.session.street = $scope.session.address[taskId].street; $scope.session.state_id = $scope.session.address[taskId].state_id; $scope.session.default = $scope.session.address[taskId].default; $scope.session.idadd = $scope.session.address[taskId].id; $scope.session.id = taskId; $scope.isAddFormOpen = true; }; $scope.RemoveAddress = function(id){$scope.session.id = id; var confirm = $mdDialog.confirm() .title('Bạn có muốn xóa địa chỉ này?') .targetEvent(id) .ok('Xóa') .cancel('Hủy'); $mdDialog.show(confirm).then(function() {Auth.removeShippingAddress($scope.session) .then(function(data){$scope.session.address =  data.results; $scope.alertMsg = data.alert; setTimeout(function () { $scope.alertMsg = false; }, 3000); }) .catch(function(err){}); }, function() {}); }; $scope.DefaultAddress = function(id){$scope.session.id = id; Auth.defaultShippingAddress($scope.session) .then(function(data){$scope.session.address =  data.results; $scope.alertMsg = 'Cập nhật địa chỉ mặc định thành công'; setTimeout(function () { $scope.alertMsg = false; }, 3000); }) .catch(function(err){}); }; $scope.submit = function(){Auth.updateShippingAddress($scope.session) .then(function(data){$scope.session.address =  data.results; $scope.alertMsg = data.alertmsg; setTimeout(function () { $scope.alertMsg = false; }, 3000); $scope.CloseFormOpen(); }) .catch(function(err){}); }; } }); });